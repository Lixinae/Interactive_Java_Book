<?xml version="1.0" encoding="UTF-8"?>
<project name="Interactive_Java_Book" default="all" basedir=".">
	<description>
		Build file for Interactive_Java_Book
	</description>

	<property file="build.properties"/>
	<!--<property name="src.dir" location="src"/>
	<property name="classes.dir" location="classes"/>
	<property name="lib.dir" location="libs"/>
	<property name="api.dir" location="./docs/api"/>
	<property name="dest.dir" location="dest"/>
	<property name="libvertx.dir" location="./vert.x-3.0.0/lib" />
-->

	<!--  Create a classpath container which can be later used in the ant task -->
	<path id="compile.classpath">
		<fileset dir="${lib.dir}">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="${libvertx.dir}">
			<include name="**/*.jar" />
		</fileset>
		<pathelement path="${classes.dir}"/>
	</path>

	<!-- Clean all the generated files -->
	<target name="clean" description="Removing the all generated files.">
		<delete dir="${classes.dir}"/>
		<delete dir="${api.dir}"/>
		<delete dir="${dest.dir}"/>
		<!--<delete file ="jshellbook.jar"/>
		<delete file ="MANIFEST.MF"/> -->
	</target>

	<!-- Cleans the folder and creates the necessary directories -->
	<target name="init" depends="clean">
		<mkdir dir="${classes.dir}"/>
		<mkdir dir="${src.dir}"/>
		<mkdir dir="${api.dir}"/>
		<mkdir dir="${dest.dir}"/>
	</target>

	<!-- Compile the program -->
	<target name="compile" depends="init" description="Compilation of all source code.">
		<javac destdir="${classes.dir}" failonerror="true" includeantruntime="false">
			<src path="${src.dir}"/>
			<classpath refid="compile.classpath"/>
		</javac>
			   <!--fork = "true"

			   classpathref="classpath"

			   -->
		<echo message="Compiling done"/>
	</target>

	<!-- Creates Javadoc -->
	<target name="javadoc" depends="compile" description="Generate documentation">
		<javadoc sourcepath="${src.dir}" destdir="${api.dir}" version="true">
			<classpath refid="compile.classpath"/>
			<!--Define which files / directory should get included, we include all
			<fileset dir="${src.dir}">
				<include name="**" />
			</fileset>
			-->
		</javadoc>
		<echo message="Java doc created"/>
	</target>

	<target name="copy_dependencies">
		<copy todir="${dest.dir}/libs">
			<fileset dir="${lib.dir}" />
		</copy>
	</target>

	<!-- Creates the executable jar file -->
	<target name="jar" depends="compile" description="Generates jshellbook.jar file in to the dest directory.">
		<pathconvert property="mf.classpath" pathsep=" ">
			<path refid="compile.classpath"/>
			<!--<mapper>
				<chainedmapper>
					<flattenmapper />
					<globmapper from="*.jar" to="libs/*.jar"/>
				</chainedmapper>
			</mapper>-->

		</pathconvert>

		<!--<echo message="mf.classpath : ${mf.classpath}"/>-->
		<tstamp/>
		<manifest file="${dest.dir}/MANIFEST.MF" >
			<attribute name ="Built-By" value="${user.name}"/>
			<attribute name ="Built-Date" value="${TODAY}"/>
			<attribute name ="Main-Class" value="${main.class}" />
			<attribute name ="Class-Path" value="${mf.classpath}"/>
		</manifest>

		<jar jarfile="${dest.dir}/${app.name}-${app.version}.jar"
			 manifest="${dest.dir}/MANIFEST.MF"
			 duplicate="preserve">

			<fileset dir="${classes.dir}"/>
			<zipfileset dir="${lib.dir}">
				<include name="**/*.jar" />
				<exclude name="**/*javadoc.jar"/>
				<exclude name="**/*sources.jar"/>
			</zipfileset>

			<zipfileset dir="${libvertx.dir}">
				<include name ="**/*.jar"/>
			</zipfileset>
            <!--<zipfileset src="${basedir}/libs/asm-all-5.0.4.jar"/>
            <zipfileset src="${basedir}/libs/jdk.jshell.jar"/>

            <zipfileset src="${basedir}/libs/Parboiled/parboiled-core-1.1.7-javadoc.jar"/>
            <zipfileset src="${basedir}/libs/Parboiled/parboiled-core-1.1.7-sources.jar"/>

            <zipfileset src="${basedir}/libs/Parboiled/parboiled-core-1.1.7.jar"/>

            <zipfileset src="${basedir}/libs/Parboiled/parboiled-java-1.1.7-javadoc.jar"/>
            <zipfileset src="${basedir}/libs/Parboiled/parboiled-java-1.1.7-sources.jar"/>

            <zipfileset src="${basedir}/libs/Parboiled/parboiled-java-1.1.7.jar"/>

            <zipfileset src="${basedir}/libs/Parboiled/parboiled-scala-1.0.2-javadoc.jar"/>
            <zipfileset src="${basedir}/libs/Parboiled/parboiled-scala-1.0.2-sources.jar"/>

            <zipfileset src="${basedir}/libs/Parboiled/parboiled-scala-1.0.2.jar"/>
            <zipfileset src="${basedir}/libs/pegdown/pegdown-1.2.1-javadoc.jar"/>
            <zipfileset src="${basedir}/libs/pegdown/pegdown-1.2.1-sources.jar"/>
            <zipfileset src="${basedir}/libs/pegdown/pegdown-1.2.1.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/jackson-annotations-2.5.0.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/jackson-core-2.5.3.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/jackson-databind-2.5.3.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/netty-buffer-4.0.28.Final.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/netty-codec-4.0.28.Final.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/netty-codec-http-4.0.28.Final.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/netty-common-4.0.28.Final.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/netty-handler-4.0.28.Final.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/netty-transport-4.0.28.Final.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/vertx-auth-common-3.0.0.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/vertx-core-3.0.0.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/vertx-mail-client-3.0.0.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/vertx-mail-service-3.0.0.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/vertx-unit-3.0.0.jar"/>
            <zipfileset src="${basedir}/vert.x-3.0.0/lib/vertx-web-3.0.0.jar"/>-->
		</jar>

		<!--
		<jar destfile="${dest.dir}/jshellbook.jar">
			<fileset dir="${classes.dir}"/>
			<restrict>
				<name name="**/*.class"/>
				<archives>
					<zips>
						<fileset dir="${lib.dir}" includes="**/*.jar"/>
					</zips>
				</archives>
			</restrict>
			<manifest>
				<attribute name ="Main-Class" value="fr.umlv.javanotebook.main.InterJavaBook" />
			</manifest>
		</jar>
		-->
		<echo message="Jar file created"/>
	</target>

	<target name="all" depends="jar,javadoc" description="Generation complete">
		<echo message="Generation complete."/>
	</target>


</project>